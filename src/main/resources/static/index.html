<!DOCTYPE html>
<html>
<head>
    <title>그룹채팅</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
    <style>
        #messages {
            height: 300px; /* 고정된 높이 */
            overflow-y: auto; /* 스크롤바 추가 */
            background-color: #f0f0f0; /* 배경색 */
            border: 1px solid #ddd; /* 테두리 */
            padding: 10px; /* 내부 여백 */
            margin-bottom: 10px; /* 아래쪽 여백 */
        }
    </style>
</head>
<body>
<h2>채팅방에 입장하세요</h2>
<input type="text" id="user-id" placeholder="사용자 ID를 입력하세요" />
<button onclick="saveUserId()">저장</button>
<br>
<input type="text" id="room-id" placeholder="채팅방 ID를 입력하세요" />
<button onclick="joinRoom()">접속</button>

<h2>채팅방</h2>
<div id="messages"></div>
<input type="text" id="message-input" placeholder="메시지를 입력하세요" />
<button onclick="sendMessage()">보내기</button>

<script type="text/javascript">
    var stompClient = null;
    var roomId = null;

    document.getElementById("user-id").addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            saveUserId();
        }
    });

    document.getElementById("room-id").addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            joinRoom();
        }
    });

    document.getElementById("message-input").addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            sendMessage();
        }
    });

    function saveUserId() {
        var userId = document.getElementById("user-id").value;
        if (userId) {
            sessionStorage.setItem("userId", userId);
            document.getElementById("room-id").focus();
        } else {
            alert("사용자 ID를 입력하세요.");
        }
    }

    function joinRoom() {
        roomId = document.getElementById("room-id").value;
        if (roomId) {
            var socket = new SockJS("/chat");
            stompClient = Stomp.over(socket);

            stompClient.connect({}, function (frame) {
                console.log("Connected: " + frame);

                stompClient.subscribe("/topic/messages/" + roomId, function (message) {
                    showMessage(message.body, "black");
                });

                showMessage(`${roomId}번 채팅방에 입장하였습니다.`, "red");
                document.getElementById("message-input").focus();
            });
        } else {
            alert("채팅방 ID를 입력하세요.");
        }
    }

    function sendMessage() {
        var message = "[" + sessionStorage.getItem("userId") + "] " +
            document.getElementById("message-input").value;
        if (stompClient && roomId) {
            stompClient.send("/app/chat/" + roomId, {}, message);
            document.getElementById("message-input").value = "";
        } else {
            alert("You are not connected to a chat room.");
        }
    }

    function showMessage(message, color) {
        var messagesDiv = document.getElementById("messages");
        var messageElement = document.createElement("div");
        messageElement.style.color = color;
        messageElement.appendChild(document.createTextNode(message));
        messagesDiv.appendChild(messageElement);
    }
</script>
</body>
</html>
